import{e as y,r,j as e,f as t}from"./index-DjdYpa2W.js";import{C as X,a as Z,b as ee,P as te,c as se,B as ae,A as ne,p as le,d as re,e as oe,f as F,L as ce,g as de}from"./index-Cynr5pvV.js";import{P as ie}from"./PageTitle-H6vnBSo9.js";import{a as v,n as xe}from"./toast-DjDqlBK5.js";import{d as g}from"./Layout-CC_gf8s-.js";import"./iconBase-TplbiNF9.js";import"./logo-color-CF1h2kui.js";const T={getAllCookieConsents:async({page:o=1,limit:p=20,consentType:c="all",device:i="all",country:m="all",startDate:C,endDate:h,search:b})=>{const x=new URLSearchParams({page:o.toString(),limit:p.toString()});return c&&c!=="all"&&x.append("consentType",c),i&&i!=="all"&&x.append("device",i),m&&m!=="all"&&x.append("country",m),C&&x.append("startDate",C),h&&x.append("endDate",h),b&&x.append("search",b),y.get(`/cookie-consent?${x.toString()}`)},getCookieConsentStats:async({startDate:o,endDate:p})=>{const c=new URLSearchParams;return o&&c.append("startDate",o),p&&c.append("endDate",p),y.get(`/cookie-consent/statistics?${c.toString()}`)},getCookieConsentById:async o=>y.get(`/cookie-consent/${o}`),deleteCookieConsent:async o=>y.delete(`/cookie-consent/${o}`),exportCookieConsents:async({startDate:o,endDate:p,consentType:c="all"})=>{const i=new URLSearchParams;return o&&i.append("startDate",o),p&&i.append("endDate",p),c&&c!=="all"&&i.append("consentType",c),y.get(`/cookie-consent/export?${i.toString()}`)}};X.register(Z,ee,te,se,ae,ne,le,re,oe);const ye=()=>{const[o,p]=r.useState(!1),[c,i]=r.useState(!1),[m,C]=r.useState(g().subtract(30,"day").format("YYYY-MM-DD")),[h,b]=r.useState(g().format("YYYY-MM-DD")),[x,D]=r.useState("all"),[N,k]=r.useState("all"),[U,$]=r.useState("all"),[Y,B]=r.useState(""),[w,H]=r.useState([]),[a,O]=r.useState(null),[A,W]=r.useState(0),[R,f]=r.useState(1),[L]=r.useState(20),[pe,V]=r.useState(0),M=async()=>{var s,d;try{i(!0);const n=await T.getCookieConsentStats({startDate:m,endDate:h});O(n)}catch(n){v(((d=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:d.message)||n.message)}finally{i(!1)}},P=async()=>{var s,d;try{p(!0);const n=await T.getAllCookieConsents({page:R,limit:L,consentType:x,device:N,country:U,startDate:m,endDate:h,search:Y});H(n.consents),W(n.totalDoc),V(n.totalPages)}catch(n){v(((d=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:d.message)||n.message)}finally{p(!1)}},q=async()=>{var s,d;try{const n=await T.exportCookieConsents({startDate:m,endDate:h,consentType:x}),l=G(n.data),j=new Blob([l],{type:"text/csv"}),u=window.URL.createObjectURL(j),S=document.createElement("a");S.href=u,S.download=`cookie-consents-${g().format("YYYY-MM-DD")}.csv`,S.click(),xe("Data exported successfully!")}catch(n){v(((d=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:d.message)||n.message)}},G=s=>{const d=["Date","Consent Type","Device","Browser","OS","Country","IP Address","Session ID"],n=s.map(l=>[g(l.createdAt).format("YYYY-MM-DD HH:mm:ss"),l.consentType,l.device,l.browser,l.os,l.country||"N/A",l.ipAddress||"N/A",l.sessionId]);return[d.join(","),...n.map(l=>l.join(","))].join(`
`)},J=()=>{f(1),M(),P()},K=()=>{C(g().subtract(30,"day").format("YYYY-MM-DD")),b(g().format("YYYY-MM-DD")),D("all"),k("all"),$("all"),B(""),f(1)};r.useEffect(()=>{M(),P()},[R]);const E=()=>a?{labels:["Accepted","Rejected","Customized"],datasets:[{label:"Consent Responses",data:[a.consentTypeStats.accepted||0,a.consentTypeStats.rejected||0,a.consentTypeStats.customized||0],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(239, 68, 68, 0.8)","rgba(59, 130, 246, 0.8)"]}]}:null,I=()=>a?{labels:["Desktop","Mobile","Tablet"],datasets:[{label:"Device Distribution",data:[a.deviceStats.desktop||0,a.deviceStats.mobile||0,a.deviceStats.tablet||0],backgroundColor:["rgba(99, 102, 241, 0.8)","rgba(168, 85, 247, 0.8)","rgba(236, 72, 153, 0.8)"]}]}:null,_=()=>{if(!a||!a.trendStats)return null;const s=[...new Set(a.trendStats.map(l=>l._id.date))],d=s.map(l=>{const j=a.trendStats.find(u=>u._id.date===l&&u._id.consentType==="accepted");return j?j.count:0}),n=s.map(l=>{const j=a.trendStats.find(u=>u._id.date===l&&u._id.consentType==="rejected");return j?j.count:0});return{labels:s,datasets:[{label:"Accepted",data:d,borderColor:"rgba(34, 197, 94, 1)",backgroundColor:"rgba(34, 197, 94, 0.2)",tension:.4},{label:"Rejected",data:n,borderColor:"rgba(239, 68, 68, 1)",backgroundColor:"rgba(239, 68, 68, 0.2)",tension:.4}]}},z=()=>!a||!a.countryStats?null:{labels:a.countryStats.map(s=>s._id||"Unknown"),datasets:[{label:"Responses by Country",data:a.countryStats.map(s=>s.count),backgroundColor:"rgba(59, 130, 246, 0.8)"}]},Q=s=>{switch(s){case"accepted":return e.jsx(t.Badge,{type:"success",children:"Accepted"});case"rejected":return e.jsx(t.Badge,{type:"danger",children:"Rejected"});case"customized":return e.jsx(t.Badge,{type:"primary",children:"Customized"});default:return e.jsx(t.Badge,{children:s})}};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:"Cookie Consent Analytics"}),e.jsx(t.Card,{className:"mb-8",children:e.jsx(t.CardBody,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-6",children:[e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"Start Date"}),e.jsx(t.Input,{type:"date",value:m,onChange:s=>C(s.target.value),className:"mt-1"})]})}),e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"End Date"}),e.jsx(t.Input,{type:"date",value:h,onChange:s=>b(s.target.value),className:"mt-1"})]})}),e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"Consent Type"}),e.jsxs(t.Select,{value:x,onChange:s=>D(s.target.value),className:"mt-1",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"accepted",children:"Accepted"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"customized",children:"Customized"})]})]})}),e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"Device"}),e.jsxs(t.Select,{value:N,onChange:s=>k(s.target.value),className:"mt-1",children:[e.jsx("option",{value:"all",children:"All Devices"}),e.jsx("option",{value:"desktop",children:"Desktop"}),e.jsx("option",{value:"mobile",children:"Mobile"}),e.jsx("option",{value:"tablet",children:"Tablet"})]})]})}),e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"Search"}),e.jsx(t.Input,{type:"text",placeholder:"Session ID or IP",value:Y,onChange:s=>B(s.target.value),className:"mt-1"})]})}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx(t.Button,{onClick:J,className:"w-full",children:"Apply"}),e.jsx(t.Button,{onClick:K,layout:"outline",className:"w-full",children:"Reset"})]})]})})}),c?e.jsx("div",{className:"text-center py-8",children:"Loading statistics..."}):a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-6 mb-8 md:grid-cols-2 xl:grid-cols-4",children:[e.jsx(t.Card,{children:e.jsx(t.CardBody,{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Responses"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-700 dark:text-gray-200",children:a.totalConsents})]})})}),e.jsx(t.Card,{children:e.jsx(t.CardBody,{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Acceptance Rate"}),e.jsxs("p",{className:"text-2xl font-semibold text-green-600",children:[a.totalConsents>0?((a.consentTypeStats.accepted||0)/a.totalConsents*100).toFixed(1):0,"%"]})]})})}),e.jsx(t.Card,{children:e.jsx(t.CardBody,{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Rejection Rate"}),e.jsxs("p",{className:"text-2xl font-semibold text-red-600",children:[a.totalConsents>0?((a.consentTypeStats.rejected||0)/a.totalConsents*100).toFixed(1):0,"%"]})]})})}),e.jsx(t.Card,{children:e.jsx(t.CardBody,{className:"flex items-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-gray-600 dark:text-gray-400",children:"Analytics Opt-in"}),e.jsx("p",{className:"text-2xl font-semibold text-blue-600",children:a.preferencesStats.analyticsAccepted||0})]})})})]}),e.jsxs("div",{className:"grid gap-6 mb-8 md:grid-cols-2",children:[e.jsx(t.Card,{children:e.jsxs(t.CardBody,{children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-700 dark:text-gray-200",children:"Consent Type Distribution"}),E()&&e.jsx("div",{style:{maxWidth:"300px",margin:"0 auto"},children:e.jsx(F,{data:E()})})]})}),e.jsx(t.Card,{children:e.jsxs(t.CardBody,{children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-700 dark:text-gray-200",children:"Device Distribution"}),I()&&e.jsx("div",{style:{maxWidth:"300px",margin:"0 auto"},children:e.jsx(F,{data:I()})})]})})]}),e.jsx(t.Card,{className:"mb-8",children:e.jsxs(t.CardBody,{children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-700 dark:text-gray-200",children:"Consent Trend Over Time"}),_()&&e.jsx("div",{style:{maxWidth:"600px",margin:"0 auto"},children:e.jsx(ce,{data:_(),options:{responsive:!0,plugins:{legend:{position:"top"}}}})})]})}),e.jsx(t.Card,{className:"mb-8",children:e.jsxs(t.CardBody,{children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-700 dark:text-gray-200",children:"Top Countries"}),z()&&e.jsx("div",{style:{maxWidth:"600px",margin:"0 auto"},children:e.jsx(de,{data:z(),options:{responsive:!0,plugins:{legend:{display:!1}}}})})]})})]}),e.jsx(t.Card,{children:e.jsxs(t.CardBody,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200",children:["Recent Consent Responses (",A,")"]}),e.jsx(t.Button,{onClick:q,size:"small",children:"Export CSV"})]}),e.jsx(t.TableContainer,{className:"mb-4",children:e.jsxs(t.Table,{children:[e.jsx(t.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(t.TableCell,{children:"Date"}),e.jsx(t.TableCell,{children:"Type"}),e.jsx(t.TableCell,{children:"Device"}),e.jsx(t.TableCell,{children:"Browser"}),e.jsx(t.TableCell,{children:"OS"}),e.jsx(t.TableCell,{children:"Country"}),e.jsx(t.TableCell,{children:"Session ID"})]})}),e.jsx(t.TableBody,{children:o?e.jsx(t.TableRow,{children:e.jsx(t.TableCell,{colSpan:"7",className:"text-center",children:"Loading..."})}):w.length===0?e.jsx(t.TableRow,{children:e.jsx(t.TableCell,{colSpan:"7",className:"text-center",children:"No consent data found"})}):w.map(s=>e.jsxs(t.TableRow,{children:[e.jsx(t.TableCell,{children:e.jsx("span",{className:"text-sm",children:g(s.createdAt).format("MMM DD, YYYY HH:mm")})}),e.jsx(t.TableCell,{children:Q(s.consentType)}),e.jsx(t.TableCell,{children:e.jsx("span",{className:"capitalize",children:s.device})}),e.jsx(t.TableCell,{children:s.browser}),e.jsx(t.TableCell,{children:s.os}),e.jsx(t.TableCell,{children:s.country||"N/A"}),e.jsx(t.TableCell,{children:e.jsxs("span",{className:"text-xs font-mono",children:[s.sessionId.substring(0,12),"..."]})})]},s._id))})]})}),e.jsx(t.TableFooter,{children:e.jsx(t.Pagination,{totalResults:A,resultsPerPage:L,onChange:s=>f(s),label:"Table navigation"})})]})})]})};export{ye as default};
