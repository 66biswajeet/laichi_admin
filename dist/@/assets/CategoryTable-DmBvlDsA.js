import{r as j,S as Z,h as y,j as e,f as c,i as O}from"./index-DjdYpa2W.js";import{u as Y,S as ee,I as $,i as se,f as ae}from"./Layout-CC_gf8s-.js";import{C as te}from"./CheckBox-46nNUpuw.js";import{T as z,D as ne,u as re}from"./DrawerButton-BVAP5kMS.js";import{D as le}from"./DeleteModal-cFnm5AMi.js";import{M as ie}from"./MainDrawer-C792pCvG.js";import{T as de}from"./ParentCategory-C6Rko6G4.js";import{a as P,n as K}from"./toast-DjDqlBK5.js";import{u as oe,E as W}from"./index.esm-r8MUZnl_.js";import{I as me}from"./InputArea-BaXQNw-P.js";import{L as E}from"./LabelArea-3SiEI5lF.js";import{S as ce}from"./SwitchToggle-BlzZU-78.js";import{T as pe,S as xe}from"./BulkActionDrawer-LUetHFDC.js";import{U as he}from"./Uploader-m7hlwNE2.js";import{C as F}from"./CouponServices-Bq0cN76W.js";import{u as ue}from"./useTranslationValue-Cw-m3XH1.js";import{E as be}from"./EditDeleteButton-DP-eF8Sj.js";const ge=(m,x)=>{const{isDrawerOpen:n,closeDrawer:N,setIsUpdate:p,lang:_}=j.useContext(Z),[d,C]=j.useState({}),[S,T]=j.useState(""),[D,h]=j.useState(""),[I,A]=j.useState([]),[l,L]=j.useState("en"),[s,o]=j.useState(!0),[f,i]=j.useState(""),[U,w]=j.useState(!1),{handlerTextTranslateHandler:k}=ue(),{register:t,handleSubmit:u,setValue:a,clearErrors:b,reset:R,formState:{errors:G}}=oe(),J=async({name:g,description:r,index:M})=>{var V,q;try{w(!0);const v=await k(g,l,d==null?void 0:d.name),X=await k(r,l,d==null?void 0:d.description),H={name:{...v,[l]:g},description:{...X,[l]:r||""},parentId:S||void 0,parentName:f||"Home",icon:D,status:s?"show":"hide",index:Number(M!==void 0?M:d&&d.index!==void 0?d.index:0),lang:l};if(m){const B=await F.updateCategory(m,H);p(!0),w(!1),K(B.message),N(),R()}else{typeof H.index=="number"&&H.index;const B=await F.addCategory(H);p(!0),w(!1),K(B.message),N()}}catch(v){w(!1),P(v?(q=(V=v==null?void 0:v.response)==null?void 0:V.data)==null?void 0:q.message:v==null?void 0:v.message),N()}},Q=g=>{L(g),Object.keys(d).length>0&&(a("name",d.name[g||"en"]),a("description",d.description[g||"en"]))};return j.useEffect(()=>{var g;if(!n){C({}),a("name"),a("index"),a("parentId"),a("parentName"),a("description"),a("icon"),h(""),o(!0),b("name"),b("parentId"),b("parentName"),b("description"),i("Home"),L(_),a("language",l),x!==void 0&&((g=x[0])==null?void 0:g._id)!==void 0&&T(x[0]._id);return}m&&(async()=>{try{const r=await F.getCategoryById(m);r&&(C(r),a("name",r.name[l||"en"]),a("description",r.description[l||"en"]),a("index",r.index!==void 0?r.index:0),a("language",l),a("parentId",r.parentId),a("parentName",r.parentName),i(r.parentName),T(r.parentId),h(r.icon),o(r.status==="show"))}catch(r){P(r?r.response.data.message:r.message)}})()},[m,a,n,l,b,x,_]),{register:t,handleSubmit:u,onSubmit:J,errors:G,imageUrl:D,setImageUrl:h,children:I,setChildren:A,published:s,setPublished:o,checked:S,setChecked:T,isSubmitting:U,selectCategoryName:f,setSelectCategoryName:i,handleSelectLanguage:Q}},je=({id:m,data:x})=>{const{t:n}=y(),{checked:N,register:p,onSubmit:_,handleSubmit:d,errors:C,imageUrl:S,setImageUrl:T,published:D,setPublished:h,setChecked:I,selectCategoryName:A,setSelectCategoryName:l,handleSelectLanguage:L,isSubmitting:s}=ge(m,x),{showingTranslateValue:o}=Y(),f=`
  .rc-tree-child-tree {
    display: hidden;
  }
  .node-motion {
    transition: all .3s;
    overflow-y: hidden;
  }
`,i={motionName:"node-motion",motionAppear:!1,onAppearStart:t=>({height:0}),onAppearActive:t=>({height:t.scrollHeight}),onLeaveStart:t=>({height:t.offsetHeight}),onLeaveActive:()=>({height:0})},U=t=>{let u=[];for(let a of t)u.push({title:o(a.name),key:a._id,children:a.children.length>0&&U(a.children)});return u},w=(t,u)=>{var a;return t._id===u?t:(a=t==null?void 0:t.children)==null?void 0:a.reduce((b,R)=>b??w(R,u),void 0)},k=async t=>{if(t!==void 0)if(m){const u=await F.getCategoryById(t);if(m===t)return P("This can't be select as a parent category!");if(m===u.parentId)return P("This can't be select as a parent category!");{if(t===void 0)return;I(t);const a=x[0],b=w(a,t);l(o(b==null?void 0:b.name))}}else{if(t===void 0)return;I(t);const u=x[0],a=w(u,t);l(o(a==null?void 0:a.name))}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:m?e.jsx(z,{register:p,title:n("UpdateCategory"),description:n("UpdateCategoryDescription")}):e.jsx(z,{register:p,title:n("AddCategoryTitle"),description:n("AddCategoryDescription")})}),e.jsx(ee,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:d(_),children:[e.jsxs("div",{className:"p-6 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(E,{label:n("Name")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(me,{required:!0,register:p,label:"Category title",name:"name",type:"text",placeholder:n("ParentCategoryPlaceholder")}),e.jsx(W,{errorName:C.name})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(E,{label:n("Description")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(pe,{register:p,label:"Description",name:"description",type:"text",placeholder:"Category Description"}),e.jsx(W,{errorName:C.description})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(E,{label:n("ParentCategory")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4 relative",children:[e.jsx(c.Input,{readOnly:!0,...p("parent",{required:!1}),name:"parent",value:A||"Home",placeholder:n("ParentCategory"),type:"text"}),e.jsxs("div",{className:"draggable-demo capitalize",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:f}}),e.jsx(de,{expandAction:"click",treeData:U(x),selectedKeys:[N],onSelect:t=>k(t[0]),motion:i,animation:"slide-up"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(E,{label:n("CategoryIcon")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(he,{imageUrl:S,setImageUrl:T,folder:"category",targetWidth:238,targetHeight:238})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(E,{label:n("Published")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(ce,{handleProcess:h,processOption:D})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(E,{label:"Index (priority)"}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(c.Input,{type:"number",...p("index",{required:!1}),name:"index",className:"w-32",placeholder:"0"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Lower value = higher priority. Example: 1 will show before 2."})]})]})]}),e.jsx(ne,{id:m,title:"Category",isSubmitting:s})]})})]})},Pe=({data:m,lang:x,isCheck:n,categories:N,setIsCheck:p,useParamId:_,showChild:d})=>{const{title:C,serviceId:S,handleModalOpen:T,handleUpdate:D}=re(),{showingTranslateValue:h}=Y(),[I,A]=j.useState({}),l=s=>{A(o=>({...o,[s]:!o[s]}))},L=s=>{const{id:o,checked:f}=s.target;p([...n,o]),f||p(n.filter(i=>i!==o))};return e.jsxs(e.Fragment,{children:[(n==null?void 0:n.length)<1&&e.jsx(le,{useParamId:_,id:S,title:C}),e.jsx(ie,{children:e.jsx(je,{id:S,data:m,lang:x})}),e.jsx(c.TableBody,{children:N==null?void 0:N.map(s=>{var o,f;return e.jsxs(c.TableRow,{className:"hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150",children:[e.jsx(c.TableCell,{children:e.jsx(te,{type:"checkbox",name:"category",id:s._id,handleClick:L,isChecked:n==null?void 0:n.includes(s._id)})}),e.jsx(c.TableCell,{className:"font-semibold uppercase text-xs",children:(o=s==null?void 0:s._id)==null?void 0:o.substring(20,24)}),e.jsx(c.TableCell,{className:"text-sm font-medium",children:s.index??0}),e.jsx(c.TableCell,{children:s!=null&&s.icon?e.jsx(c.Avatar,{className:"hidden mr-3 md:block bg-gray-50 border border-gray-200 dark:bg-gray-700 dark:border-gray-600 shadow-sm p-1",src:s==null?void 0:s.icon,alt:s==null?void 0:s.parent}):e.jsx(c.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product",className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none"})}),e.jsx(c.TableCell,{className:"font-medium text-sm",children:(s==null?void 0:s.children.length)>0?e.jsxs(O,{to:`/categories/${s==null?void 0:s._id}`,className:"text-blue-700 hover:text-blue-800 font-medium transition-colors duration-150",children:[h(s==null?void 0:s.name),e.jsx(e.Fragment,{children:d&&e.jsxs(e.Fragment,{children:[" ",e.jsx("div",{className:"pl-2 mt-2 space-y-1.5",children:(f=s==null?void 0:s.children)==null?void 0:f.map(i=>e.jsx("div",{children:e.jsx(O,{to:`/categories/${i==null?void 0:i._id}`,className:"text-blue-700",children:e.jsxs("div",{className:"flex text-xs items-center text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx("span",{className:"text-xs text-blue-500 pr-2",children:e.jsx($,{})}),e.jsx("span",{children:h(i.name)})]})})},i._id))})]})})]}):e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:h(s==null?void 0:s.name)})}),e.jsx(c.TableCell,{className:"text-sm",children:s!=null&&s.children&&(s==null?void 0:s.children.length)>0?e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>l(s._id),className:"flex items-center space-x-2 text-blue-600 hover:text-blue-700 font-medium transition-all duration-200 hover:scale-105",children:[I[s._id]?e.jsx(se,{className:"w-4 h-4"}):e.jsx(ae,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-xs",children:[s.children.length," ",s.children.length===1?"Subcategory":"Subcategories"]})]}),I[s._id]&&e.jsx("div",{className:"mt-2 ml-4 space-y-1.5 border-l-2 border-blue-300 dark:border-blue-600 pl-3 animate-slideDown",children:s.children.map(i=>e.jsxs("div",{className:"flex items-center text-xs hover:translate-x-1 transition-transform duration-200",children:[e.jsx("span",{className:"text-blue-400 pr-1.5",children:e.jsx($,{})}),e.jsx(O,{to:`/categories/${i._id}`,className:"text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 hover:underline",children:h(i.name)})]},i._id))})]}):e.jsx("span",{className:"text-gray-400 text-xs italic",children:"No subcategories"})}),e.jsx(c.TableCell,{className:"text-center",children:e.jsx(xe,{id:s._id,category:!0,status:s.status})}),e.jsx(c.TableCell,{children:e.jsx(be,{id:s==null?void 0:s._id,parent:s,isCheck:n,children:s==null?void 0:s.children,handleUpdate:D,handleModalOpen:T,title:h(s==null?void 0:s.name)})})]},s._id)})})]})};export{je as C,Pe as a};
