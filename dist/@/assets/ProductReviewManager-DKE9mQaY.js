import{h as U,q as $,s as G,r,j as e,f as t}from"./index-DjdYpa2W.js";import{L as J,b as K,c as Q}from"./Layout-CC_gf8s-.js";import{s as V}from"./sweetalert.min-CJsXi30a.js";import{P as j}from"./ProductReviewServices-AfLdZV_w.js";import{P as W}from"./PageTitle-H6vnBSo9.js";import{A as X}from"./AnimatedContent-Dramat6q.js";import{T as Y}from"./TableLoading-u8ybCk9T.js";import{a as d,n as C}from"./toast-DjDqlBK5.js";import"./iconBase-TplbiNF9.js";import"./logo-color-CF1h2kui.js";const ce=()=>{var P;const{t:A}=U(),B=$(),{productId:o}=G(),[L,v]=r.useState(!1),[i,q]=r.useState(null),[T,F]=r.useState([]),[S,M]=r.useState(0),[w,D]=r.useState(0),[b,m]=r.useState(""),[f,x]=r.useState(""),[h,g]=r.useState(5),[c,y]=r.useState(null),[k,p]=r.useState(!1),N=async()=>{var s,l;try{v(!0);const a=await j.getProductReviews(o);q(a.product),F(a.reviews),M(a.averageRating),D(a.totalReviews),v(!1)}catch(a){v(!1),d(((l=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:l.message)||a.message)}};r.useEffect(()=>{o&&N()},[o]);const I=async s=>{var l,a;if(s.preventDefault(),!b.trim())return d("Reviewer name is required!");if(!f.trim())return d("Comment is required!");if(h<1||h>5)return d("Rating must be between 1 and 5!");try{p(!0);const n={productId:o,reviewerName:b,comment:f,rating:Number(h)};c?(await j.updateProductReview(c._id,n),C("Review updated successfully!")):(await j.addProductReview(n),C("Review added successfully!")),m(""),x(""),g(5),y(null),N(),p(!1)}catch(n){p(!1),d(((a=(l=n==null?void 0:n.response)==null?void 0:l.data)==null?void 0:a.message)||n.message)}},_=s=>{y(s),m(s.reviewerName),x(s.comment),g(s.rating),window.scrollTo({top:0,behavior:"smooth"})},z=()=>{y(null),m(""),x(""),g(5)},H=async s=>{V({title:"Are you sure?",text:"Once deleted, you will not be able to recover this review!",icon:"warning",buttons:!0,dangerMode:!0}).then(async l=>{var a,n;if(l)try{await j.deleteProductReview(s),C("Review deleted successfully!"),N()}catch(u){d(((n=(a=u==null?void 0:u.response)==null?void 0:a.data)==null?void 0:n.message)||u.message)}})},E=s=>{const l=[];for(let a=1;a<=5;a++)l.push(e.jsx("span",{className:a<=s?"text-yellow-400":"text-gray-300",children:"★"},a));return l},O=()=>{const s=[];for(let l=1;l<=5;l++)s.push(e.jsx("button",{type:"button",onClick:()=>g(l),className:`text-3xl ${l<=h?"text-yellow-400":"text-gray-300"} hover:text-yellow-400 transition-colors`,children:"★"},l));return s},R=typeof(i==null?void 0:i.title)=="string"?i==null?void 0:i.title:((P=i==null?void 0:i.title)==null?void 0:P.en)||"Product";return e.jsxs(e.Fragment,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>B.goBack(),className:"text-blue-600 hover:text-blue-800",children:e.jsx(J,{className:"text-xl"})}),e.jsxs("span",{children:[A("ManageReviews")," - ",R]})]})}),e.jsxs(X,{children:[i&&e.jsx(t.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(t.CardBody,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[i.image&&i.image[0]&&e.jsx("img",{className:"h-20 w-20 rounded-lg object-cover",src:i.image[0],alt:R}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200",children:R}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex text-xl",children:E(Math.round(S))}),e.jsxs("span",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400",children:[S," / 5.0"]})]}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["(",w," ",w===1?"review":"reviews",")"]})]})]})]})})}),e.jsx(t.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsxs(t.CardBody,{children:[e.jsx("h4",{className:"mb-4 font-semibold text-gray-700 dark:text-gray-200",children:c?"Edit Review":"Add New Review"}),e.jsx("form",{onSubmit:I,children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"Reviewer Name"}),e.jsx(t.Input,{className:"mt-1",type:"text",placeholder:"Enter reviewer name",value:b,onChange:s=>m(s.target.value),required:!0})]})}),e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"Rating"}),e.jsx("div",{className:"flex gap-1 mt-2",children:O()})]})}),e.jsx("div",{children:e.jsxs(t.Label,{children:[e.jsx("span",{children:"Comment"}),e.jsx(t.Textarea,{className:"mt-1",rows:"4",placeholder:"Enter review comment",value:f,onChange:s=>x(s.target.value),required:!0})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t.Button,{type:"submit",disabled:k,className:"w-full sm:w-auto",children:k?"Saving...":c?"Update Review":"Add Review"}),c&&e.jsx(t.Button,{type:"button",layout:"outline",onClick:z,className:"w-full sm:w-auto",children:"Cancel"})]})]})})]})}),e.jsx(t.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800",children:e.jsxs(t.CardBody,{children:[e.jsxs("h4",{className:"mb-4 font-semibold text-gray-700 dark:text-gray-200",children:["All Reviews (",w,")"]}),L?e.jsx(Y,{row:5,col:5,width:160,height:20}):T.length===0?e.jsx("div",{className:"text-center py-10 text-gray-500 dark:text-gray-400",children:"No reviews yet. Add the first review!"}):e.jsx(t.TableContainer,{className:"mb-8",children:e.jsxs(t.Table,{children:[e.jsx(t.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(t.TableCell,{children:"Reviewer"}),e.jsx(t.TableCell,{children:"Rating"}),e.jsx(t.TableCell,{children:"Comment"}),e.jsx(t.TableCell,{children:"Date"}),e.jsx(t.TableCell,{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100 dark:divide-gray-700 dark:bg-gray-800 text-gray-700 dark:text-gray-400",children:T.map(s=>e.jsxs("tr",{children:[e.jsx(t.TableCell,{children:e.jsx("span",{className:"font-semibold",children:s.reviewerName})}),e.jsx(t.TableCell,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex text-lg",children:E(s.rating)}),e.jsx("span",{className:"text-sm",children:s.rating})]})}),e.jsx(t.TableCell,{children:e.jsx("span",{className:"text-sm line-clamp-2",children:s.comment})}),e.jsx(t.TableCell,{children:e.jsx("span",{className:"text-sm",children:new Date(s.createdAt).toLocaleDateString()})}),e.jsx(t.TableCell,{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(t.Button,{layout:"link",size:"icon","aria-label":"Edit",onClick:()=>_(s),children:e.jsx(K,{className:"text-lg text-blue-600"})}),e.jsx(t.Button,{layout:"link",size:"icon","aria-label":"Delete",onClick:()=>H(s._id),children:e.jsx(Q,{className:"text-lg text-red-600"})})]})})]},s._id))})]})})]})})]})]})};export{ce as default};
